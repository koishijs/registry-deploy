var it=Object.defineProperty;var ht=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var mt=Object.prototype.hasOwnProperty;var X=(t,r)=>()=>(t&&(r=t(t=0)),r);var Y=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var U=(t,r,o,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let m of dt(r))!mt.call(t,m)&&m!==o&&it(t,m,{get:()=>r[m],enumerable:!(c=ht(r,m))||c.enumerable});return t},A=(t,r,o)=>(U(t,r,"default"),o&&U(o,r,"default"));var st=t=>U(it({},"__esModule",{value:!0}),t);import{Buffer as W}from"https://registry.koishi.chat/modules/buffer/index.js";import Q from"https://registry.koishi.chat/modules/process/index.js";var $=X(()=>{});var D={};import*as _t from"https://registry.koishi.chat/modules/cosmokit/index.js";var nt=X(()=>{$();A(D,_t)});var ct=Y((St,ot)=>{$();var gt=Object.defineProperty,p=(t,r)=>gt(t,"name",{value:r,configurable:!0}),y=(nt(),st(D)),at=Symbol.for("satori.element");function E(t){return t&&typeof t=="object"&&t[at]}p(E,"isElement");function Z(t){if(typeof t=="string"||typeof t=="number"||typeof t=="boolean"){if(t=""+t,t)return q("text",{content:t})}else{if(E(t))return t;if(!(0,y.isNullable)(t))throw new TypeError(`Invalid content: ${t}`)}}p(Z,"toElement");function I(t){return Array.isArray(t)?t.map(Z).filter(r=>r):[Z(t)].filter(r=>r)}p(I,"toElementArray");var K=class{get data(){return this.attrs}toString(t=!1){if(this.type==="text")return t?this.attrs.content:q.escape(this.attrs.content);let r=this.children.map(c=>c.toString(t)).join("");if(t)return r;let o=Object.entries(this.attrs).map(([c,m])=>(0,y.isNullable)(m)?"":(c=(0,y.hyphenate)(c),m===!0?` ${c}`:m===!1?` no-${c}`:` ${c}="${q.escape(""+m,!0)}"`)).join("");return this.children.length?`<${this.type}${o}>${r}</${this.type}>`:`<${this.type}${o}/>`}};p(K,"ElementConstructor");(0,y.defineProperty)(K,"name","Element");(0,y.defineProperty)(K.prototype,at,!0);function q(t,...r){let o=Object.create(K.prototype),c={},m=[];if(r[0]&&typeof r[0]=="object"&&!E(r[0])&&!Array.isArray(r[0])){let S=r.shift();for(let[F,h]of Object.entries(S))(0,y.isNullable)(h)||(F==="children"?r.push(...(0,y.makeArray)(h)):c[F]=h)}for(let S of r)m.push(...I(S));return Object.assign(o,{type:t,attrs:c,children:m})}p(q,"Element");var yt=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(t=>{t.jsx=t,t.jsxs=t,t.jsxDEV=t,t.Fragment="template";function r(i,e){return typeof i!="string"?I(i):t.parse(i,e)}t.normalize=r,p(r,"normalize");function o(i,e=!1){let s=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e?s.replace(/"/g,"&quot;"):s}t.escape=o,p(o,"escape");function c(i){return i.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(e,s)=>s==="38"?e:String.fromCharCode(+s)).replace(/&#x([0-9a-f]+);/gi,(e,s)=>s==="26"?e:String.fromCharCode(parseInt(s,16))).replace(/&(amp|#38|#x26);/g,"&")}t.unescape=c,p(c,"unescape");function m(i,e={}){var s;let a=k(i);return e.caret?e.type&&((s=a[0])==null?void 0:s.type)!==e.type?void 0:a[0]:h(a,e.type||"*")[0]}t.from=m,p(m,"from");let S=/ *([ >+~]) */g;function F(i){return i.split(",").map(e=>{let s=[];e=e.trim();let a,u=" ";for(;a=S.exec(e);)s.push({type:e.slice(0,a.index),combinator:u}),u=a[1],e=e.slice(a.index+a[0].length);return s.push({type:e,combinator:u}),s})}t.parseSelector=F,p(F,"parseSelector");function h(i,e){if(!i||!e)return[];if(typeof i=="string"&&(i=k(i)),typeof e=="string"&&(e=F(e)),!e.length)return[];let s=[],a=[];for(let[u,g]of i.entries()){let j=[],l=[...e,...s];s=[];let b=!1;for(let n of l){let{type:f,combinator:C}=n[0];(f===g.type||f==="*")&&(n.length===1?b=!0:[" ",">"].includes(n[1].combinator)?j.push(n.slice(1)):n[1].combinator==="+"?s.push(n.slice(1)):e.push(n.slice(1))),C===" "&&j.push(n)}b&&a.push(i[u]),a.push(...h(g.children,j))}return a}t.select=h,p(h,"select");function v(i,e){var s;if(i=i.trim(),!/^[\w.]+$/.test(i))return(s=yt(i,e))!=null?s:"";let a=e;for(let u of i.split("."))if(a=a[u],(0,y.isNullable)(a))return"";return a??""}t.interpolate=v,p(v,"interpolate");let T=/<!--[\s\S]*?-->|<(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>/,x=/([^\s=]+)(?:="([^"]*)"|='([^']*)')?/g,V=/([^\s=]+)(?:="([^"]*)"|='([^']*)'|=\{([^}]+)\})?/g,G=/\{([^}]*)\}/;function k(i,e){let s=[];function a(n){n&&s.push(t("text",{content:n}))}p(a,"pushText");let u=e?V:x,g;for(;g=T.exec(i);){j(i.slice(0,g.index));let[n,f,C,J,L]=g;if(i=i.slice(g.index+n.length),n.startsWith("<!"))continue;let P={source:n,type:C||t.Fragment,close:f,empty:L,attrs:{}},tt;for(;tt=u.exec(J);){let[vt,R,ft,et=ft,rt]=tt;rt?P.attrs[(0,y.camelize)(R)]=v(rt,e):(0,y.isNullable)(et)?R.startsWith("no-")?P.attrs[(0,y.camelize)(R.slice(3))]=!1:P.attrs[(0,y.camelize)(R)]=!0:P.attrs[(0,y.camelize)(R)]=c(et)}s.push(P)}j(i);function j(n){if(n=n.replace(/^\s*\n\s*/,"").replace(/\s*\n\s*$/,""),e){let f;for(;f=G.exec(n);){let[C,J]=f;a(c(n.slice(0,f.index))),n=n.slice(f.index+C.length);let L=v(J,e);s.push(...I(L))}}a(c(n))}p(j,"parseContent");let l=[t(t.Fragment)];function b(n){for(;n>0;n--){let{children:f}=l.shift(),{source:C}=l[0].children.pop();l[0].children.push(t("text",{content:C})),l[0].children.push(...f)}}p(b,"rollback");for(let n of s)if(E(n))l[0].children.push(n);else if(n.close){let f=0;for(;f<l.length&&l[f].type!==n.type;)f++;if(f===l.length)l[0].children.push(t("text",{content:n.source}));else{b(f);let C=l.shift();delete C.source}}else{let f=t(n.type,n.attrs);l[0].children.push(f),n.empty||(f.source=n.source,l.unshift(f))}return b(l.length-1),l[0].children}t.parse=k,p(k,"parse");function B(i,e,s){var a,u;let{type:g,attrs:j,children:l}=i;if(typeof e=="function")return e(i,s);{let b=(u=(a=e[g])!=null?a:e.default)!=null?u:!0;return typeof b=="function"&&(b=b(j,l,s)),b}}p(B,"visit");function w(i,e,s){let a=typeof i=="string"?k(i):i,u=[];return a.forEach(g=>{let{type:j,attrs:l,children:b}=g,n=B(g,e,s);n===!0?u.push(t(j,l,w(b,e,s))):n!==!1&&u.push(...r(n))}),typeof i=="string"?u.join(""):u}t.transform=w,p(w,"transform");async function H(i,e,s){let a=typeof i=="string"?k(i):i,u=(await Promise.all(a.map(async g=>{let{type:j,attrs:l,children:b}=g,n=await B(g,e,s);return n===!0?[t(j,l,await H(b,e,s))]:n!==!1?r(n):[]}))).flat(1);return typeof i=="string"?u.join(""):u}t.transformAsync=H,p(H,"transformAsync");function M(i,...e){return(...s)=>{let a=t(i);return e.forEach((u,g)=>{(0,y.isNullable)(s[g])||(a.attrs[u]=s[g])}),s[e.length]&&Object.assign(a.attrs,s[e.length]),a}}p(M,"createFactory"),t.warn=p(()=>{},"warn");function O(i){return(e,...s)=>{let a="base64://";return typeof s[0]=="string"&&(a=`data:${s.shift()};base64,`),(0,y.is)("Buffer",e)?e=a+e.toString("base64"):(0,y.is)("ArrayBuffer",e)&&(e=a+(0,y.arrayBufferToBase64)(e)),e.startsWith("base64://")&&(0,t.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),t(i,{...s[0],url:e})}}p(O,"createAssetFactory"),t.text=M("text","content"),t.at=M("at","id"),t.sharp=M("sharp","id"),t.quote=M("quote","id"),t.image=O("image"),t.video=O("video"),t.audio=O("audio"),t.file=O("file")})(q||(q={}));ot.exports=q});var N={};import*as Dt from"https://registry.koishi.chat/modules/koishi/index.js";var ut=X(()=>{$();A(N,Dt)});var lt=Y((Nt,bt)=>{bt.exports={name:"koishi-plugin-music",description:"Share Music in Koishi",version:"2.2.1",main:"lib/index.js",typings:"lib/index.d.ts",files:["lib","dist"],author:"Shigma <shigma10826@gmail.com>",license:"MIT",repository:{type:"git",url:"git+https://github.com/koishijs/koishi-plugin-music.git"},bugs:{url:"https://github.com/koishijs/koishi-plugin-music/issues"},homepage:"https://github.com/koishijs/koishi-plugin-music",scripts:{build:"tsc -b"},keywords:["chatbot","koishi","plugin","music","share","search","netease","qq"],koishi:{browser:!0,description:{en:"Share music (supports QQ Music and Netease Cloud Music)",zh:"分享音乐（目前支持 QQ 音乐和网易云音乐）"},service:{optional:["puppeteer"]}},peerDependencies:{koishi:"^4.10.3","koishi-plugin-puppeteer":"^3.4.1"},peerDependenciesMeta:{"koishi-plugin-puppeteer":{optional:!0}},devDependencies:{"@types/node":"^18.11.18",koishi:"^4.11.3",typescript:"^4.9.4"}}});var Ft=Y(_=>{$();Object.defineProperty(_,"__esModule",{value:!0});_.apply=_.name=_.Config=void 0;var d=ct(),z=(ut(),st(N)),{version:xt}=lt();_.Config=z.Schema.object({platform:z.Schema.union(["netease","qq"]).default("qq").description("默认的点歌平台。"),imageMode:z.Schema.boolean().default(!0).description("是否使用图片模式 (需要 puppeteer 服务)。"),showWarning:z.Schema.boolean().default(!1).description("点歌失败时是否发送提示。")});var pt={async netease(t){let r=await this.http.get("http://music.163.com/api/cloudsearch/pc",{params:{s:t,type:1,offset:0,limit:5}});if(!(r.code!==200||r.result.songCount===0))return r.result.songs.map(o=>({type:"163",id:o.id,name:o.name,artist:o.ar.map(c=>c.name).join("/"),url:`https://music.163.com/#/song?id=${o.id}`,album:o.al.name}))},async qq(t){let r=await this.http.get("https://c.y.qq.com/splcloud/fcgi-bin/smartbox_new.fcg",{params:{key:t,format:"json"}});if(!(r.code||r.data.song.count===0))return r.data.song.itemlist.map(o=>({type:"qq",id:o.id,name:o.name,artist:o.singer,url:`https://y.qq.com/n/ryqq/songDetail/${o.mid}`,album:""}))}};_.name="music";function jt(t,r){let{showWarning:o,platform:c,imageMode:m}=r;function S(F){return m&&t.puppeteer?(0,d.jsxs)("html",{style:{color:"#ffffff",background:"#333333",padding:"1rem"},children:[(0,d.jsx)("style",{children:`
          th, td {
            padding: 0.25rem 0.5rem;
          }
          .index, .title {
            text-align: center;
          }
        `}),(0,d.jsx)("p",{children:"我们找到了多个可能符合条件的歌曲，请输入序号进行选择："}),(0,d.jsxs)("table",{children:[(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{class:"index",children:"编号"}),(0,d.jsx)("th",{class:"title",children:"名称"}),(0,d.jsx)("th",{children:"歌手"})]}),F.map((h,v)=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:v+1}),(0,d.jsx)("td",{children:h.name}),(0,d.jsx)("td",{children:h.artist})]}))]}),(0,d.jsxs)("p",{children:["Generated by Koishi v",z.version," / koishi-plugin-music v",xt]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{children:"我们找到了多个可能符合条件的歌曲，请输入序号进行选择："}),F.map((h,v)=>(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("p",{children:[v+1,". ",h.name," ",h.artist," ",h.album]})}))]})}t.command("music <name:text>","点歌").option("platform",`-p <platform>  点歌平台，目前支持 qq, netease，默认为 ${c}`,{type:Object.keys(pt)}).alias("点歌").shortcut("来一首",{fuzzy:!0}).shortcut("点一首",{fuzzy:!0}).shortcut("整一首",{fuzzy:!0}).action(async({session:F,options:h},v)=>{h.platform||(h.platform=c);let T=pt[h.platform];if(!T)return`目前不支持平台 ${h.platform}。`;if(!v)return"请输入歌曲相关信息。";try{let x=await T.call(t,v);if(Array.isArray(x)&&x.length>0){if(x.length>1){await F.send(S(x));let B=await F.prompt();if(!B||Number.isNaN(+B))return"请输入正确的序号。";let w=+B-1;return x[w]?(0,z.segment)("onebot:music",x[w],`${x[w].name}
${x[w].artist}
${x[w].url}`):"请输入正确的序号。"}let{name:V,artist:G,url:k}=x[0];return(0,z.segment)("onebot:music",x,`${V}
${G}
${k}`)}}catch{}if(o)return"点歌失败，请尝试更换平台。"})}_.apply=jt});export default Ft();
