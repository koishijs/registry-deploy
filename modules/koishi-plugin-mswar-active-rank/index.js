var rt=Object.defineProperty;var ft=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var ht=Object.prototype.hasOwnProperty;var Z=(t,r)=>()=>(t&&(r=t(t=0)),r);var it=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var Y=(t,r,x,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let m of ut(r))!ht.call(t,m)&&m!==x&&rt(t,m,{get:()=>r[m],enumerable:!(c=ft(r,m))||c.enumerable});return t},F=(t,r,x)=>(Y(t,r,"default"),x&&Y(x,r,"default"));var st=t=>Y(rt({},"__esModule",{value:!0}),t);import{Buffer as K}from"https://registry.koishi.chat/modules/buffer/index.js";import M from"https://registry.koishi.chat/modules/process/index.js";var $=Z(()=>{});var P={};import*as St from"https://registry.koishi.chat/modules/cosmokit/index.js";var nt=Z(()=>{$();F(P,St)});var ct=it((kt,ot)=>{$();var dt=Object.defineProperty,f=(t,r)=>dt(t,"name",{value:r,configurable:!0}),g=(nt(),st(P)),at=Symbol.for("satori.element");function H(t){return t&&typeof t=="object"&&t[at]}f(H,"isElement");function q(t){if(typeof t=="string"||typeof t=="number"||typeof t=="boolean"){if(t=""+t,t)return B("text",{content:t})}else{if(H(t))return t;if(!(0,g.isNullable)(t))throw new TypeError(`Invalid content: ${t}`)}}f(q,"toElement");function V(t){return Array.isArray(t)?t.map(q).filter(r=>r):[q(t)].filter(r=>r)}f(V,"toElementArray");var L=class{get data(){return this.attrs}toString(t=!1){if(this.type==="text")return t?this.attrs.content:B.escape(this.attrs.content);let r=this.children.map(c=>c.toString(t)).join("");if(t)return r;let x=Object.entries(this.attrs).map(([c,m])=>(0,g.isNullable)(m)?"":(c=(0,g.hyphenate)(c),m===!0?` ${c}`:m===!1?` no-${c}`:` ${c}="${B.escape(""+m,!0)}"`)).join("");return this.children.length?`<${this.type}${x}>${r}</${this.type}>`:`<${this.type}${x}/>`}};f(L,"ElementConstructor");(0,g.defineProperty)(L,"name","Element");(0,g.defineProperty)(L.prototype,at,!0);function B(t,...r){let x=Object.create(L.prototype),c={},m=[];if(r[0]&&typeof r[0]=="object"&&!H(r[0])&&!Array.isArray(r[0])){let b=r.shift();for(let[S,_]of Object.entries(b))(0,g.isNullable)(_)||(S==="children"?r.push(...(0,g.makeArray)(_)):c[S]=_)}for(let b of r)m.push(...V(b));return Object.assign(x,{type:t,attrs:c,children:m})}f(B,"Element");var mt=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(t=>{t.jsx=t,t.jsxs=t,t.jsxDEV=t,t.Fragment="template";function r(i,e){return typeof i!="string"?V(i):t.parse(i,e)}t.normalize=r,f(r,"normalize");function x(i,e=!1){let s=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e?s.replace(/"/g,"&quot;"):s}t.escape=x,f(x,"escape");function c(i){return i.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(e,s)=>s==="38"?e:String.fromCharCode(+s)).replace(/&#x([0-9a-f]+);/gi,(e,s)=>s==="26"?e:String.fromCharCode(parseInt(s,16))).replace(/&(amp|#38|#x26);/g,"&")}t.unescape=c,f(c,"unescape");function m(i,e={}){var s;let a=C(i);return e.caret?e.type&&((s=a[0])==null?void 0:s.type)!==e.type?void 0:a[0]:_(a,e.type||"*")[0]}t.from=m,f(m,"from");let b=/ *([ >+~]) */g;function S(i){return i.split(",").map(e=>{let s=[];e=e.trim();let a,l=" ";for(;a=b.exec(e);)s.push({type:e.slice(0,a.index),combinator:l}),l=a[1],e=e.slice(a.index+a[0].length);return s.push({type:e,combinator:l}),s})}t.parseSelector=S,f(S,"parseSelector");function _(i,e){if(!i||!e)return[];if(typeof i=="string"&&(i=C(i)),typeof e=="string"&&(e=S(e)),!e.length)return[];let s=[],a=[];for(let[l,d]of i.entries()){let j=[],p=[...e,...s];s=[];let y=!1;for(let n of p){let{type:u,combinator:z}=n[0];(u===d.type||u==="*")&&(n.length===1?y=!0:[" ",">"].includes(n[1].combinator)?j.push(n.slice(1)):n[1].combinator==="+"?s.push(n.slice(1)):e.push(n.slice(1))),z===" "&&j.push(n)}y&&a.push(i[l]),a.push(..._(d.children,j))}return a}t.select=_,f(_,"select");function k(i,e){var s;if(i=i.trim(),!/^[\w.]+$/.test(i))return(s=mt(i,e))!=null?s:"";let a=e;for(let l of i.split("."))if(a=a[l],(0,g.isNullable)(a))return"";return a??""}t.interpolate=k,f(k,"interpolate");let R=/<!--[\s\S]*?-->|<(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>/,h=/([^\s=]+)(?:="([^"]*)"|='([^']*)')?/g,A=/([^\s=]+)(?:="([^"]*)"|='([^']*)'|=\{([^}]+)\})?/g,D=/\{([^}]*)\}/;function C(i,e){let s=[];function a(n){n&&s.push(t("text",{content:n}))}f(a,"pushText");let l=e?A:h,d;for(;d=R.exec(i);){j(i.slice(0,d.index));let[n,u,z,U,X]=d;if(i=i.slice(d.index+n.length),n.startsWith("<!"))continue;let W={source:n,type:z||t.Fragment,close:u,empty:X,attrs:{}},E;for(;E=l.exec(U);){let[yt,G,pt,tt=pt,et]=E;et?W.attrs[(0,g.camelize)(G)]=k(et,e):(0,g.isNullable)(tt)?G.startsWith("no-")?W.attrs[(0,g.camelize)(G.slice(3))]=!1:W.attrs[(0,g.camelize)(G)]=!0:W.attrs[(0,g.camelize)(G)]=c(tt)}s.push(W)}j(i);function j(n){if(n=n.replace(/^\s*\n\s*/,"").replace(/\s*\n\s*$/,""),e){let u;for(;u=D.exec(n);){let[z,U]=u;a(c(n.slice(0,u.index))),n=n.slice(u.index+z.length);let X=k(U,e);s.push(...V(X))}}a(c(n))}f(j,"parseContent");let p=[t(t.Fragment)];function y(n){for(;n>0;n--){let{children:u}=p.shift(),{source:z}=p[0].children.pop();p[0].children.push(t("text",{content:z})),p[0].children.push(...u)}}f(y,"rollback");for(let n of s)if(H(n))p[0].children.push(n);else if(n.close){let u=0;for(;u<p.length&&p[u].type!==n.type;)u++;if(u===p.length)p[0].children.push(t("text",{content:n.source}));else{y(u);let z=p.shift();delete z.source}}else{let u=t(n.type,n.attrs);p[0].children.push(u),n.empty||(u.source=n.source,p.unshift(u))}return y(p.length-1),p[0].children}t.parse=C,f(C,"parse");function J(i,e,s){var a,l;let{type:d,attrs:j,children:p}=i;if(typeof e=="function")return e(i,s);{let y=(l=(a=e[d])!=null?a:e.default)!=null?l:!0;return typeof y=="function"&&(y=y(j,p,s)),y}}f(J,"visit");function I(i,e,s){let a=typeof i=="string"?C(i):i,l=[];return a.forEach(d=>{let{type:j,attrs:p,children:y}=d,n=J(d,e,s);n===!0?l.push(t(j,p,I(y,e,s))):n!==!1&&l.push(...r(n))}),typeof i=="string"?l.join(""):l}t.transform=I,f(I,"transform");async function Q(i,e,s){let a=typeof i=="string"?C(i):i,l=(await Promise.all(a.map(async d=>{let{type:j,attrs:p,children:y}=d,n=await J(d,e,s);return n===!0?[t(j,p,await Q(y,e,s))]:n!==!1?r(n):[]}))).flat(1);return typeof i=="string"?l.join(""):l}t.transformAsync=Q,f(Q,"transformAsync");function N(i,...e){return(...s)=>{let a=t(i);return e.forEach((l,d)=>{(0,g.isNullable)(s[d])||(a.attrs[l]=s[d])}),s[e.length]&&Object.assign(a.attrs,s[e.length]),a}}f(N,"createFactory"),t.warn=f(()=>{},"warn");function T(i){return(e,...s)=>{let a="base64://";return typeof s[0]=="string"&&(a=`data:${s.shift()};base64,`),(0,g.is)("Buffer",e)?e=a+e.toString("base64"):(0,g.is)("ArrayBuffer",e)&&(e=a+(0,g.arrayBufferToBase64)(e)),e.startsWith("base64://")&&(0,t.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),t(i,{...s[0],url:e})}}f(T,"createAssetFactory"),t.text=N("text","content"),t.at=N("at","id"),t.sharp=N("sharp","id"),t.quote=N("quote","id"),t.image=T("image"),t.video=T("video"),t.audio=T("audio"),t.file=T("file")})(B||(B={}));ot.exports=B});var O={};import*as At from"https://registry.koishi.chat/modules/koishi/index.js";var lt=Z(()=>{$();F(O,At)});var xt=it(v=>{$();Object.defineProperty(v,"__esModule",{value:!0});v.apply=v.Config=v.Rule=v.usage=v.name=void 0;var o=ct(),w=(lt(),st(O));v.name="mswar-active-rank";v.usage=`
## 注意事项
> 建议使用前玩一局[扫雷联萌](http://tapsss.com)
作者服务器经常掉线，支持<a href=https://github.com/initialencounter/mykoishi/smear_rank">自建服务器</a>
本插件只用于体现 Koishi 部署者意志”。
对于部署者行为及所产生的任何纠纷， Koishi 及 koishi-plugin-mswar-active-rank 概不负责。
如果有更多文本内容想要修改，可以在<a href="/locales">本地化</a>中修改 zh 内容
`;v.Rule=w.Schema.object({platform:w.Schema.string().description("平台名称。").required(),channelId:w.Schema.string().description("频道 ID。").required(),guildId:w.Schema.string().description("群组 ID。"),selfId:w.Schema.string().description("机器人 ID。")});v.Config=w.Schema.object({api_hostname:w.Schema.string().description("自建服务器地址").default("http://116.205.167.54:5140"),rules:w.Schema.array(v.Rule).description("推送规则。"),interval:w.Schema.number().default(w.Time.minute*30).description("轮询间隔 (毫秒)。"),background_img:w.Schema.string().default("https://img0.baidu.com/it/u=2013803511,2814800709&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500").description("背景图片url,http开头:"),border:w.Schema.string().default("&").description("边界")});function gt(t,r){let x=`${r.api_hostname}/get`;var c=r.background_img;new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i").test(r.background_img)||(c="https://img0.baidu.com/it/u=2013803511,2814800709&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500"),t.command("扫雷活跃榜").alias("ms-ac").action(async()=>{let b=await t.http.get(x),S=b.mine_rank.今日.高级,_=b.puzzle_rank.今日["4x4"],k=[(0,o.jsx)("div",{children:"扫雷联萌tapsss.com"}),(0,o.jsx)("div",{children:"扫雷高级日榜"}),(0,o.jsx)("br",{})];S.forEach((h,A)=>{k.push((0,o.jsxs)("div",{children:[h[0],". ",h[1]," ",h[3]]}))});let R=[(0,o.jsx)("div",{children:b.update_time}),(0,o.jsx)("div",{children:"15p日榜"}),(0,o.jsx)("br",{})];return _.forEach((h,A)=>{R.push((0,o.jsxs)("div",{children:["|",r.border,"|",h[0],". ",h[1]," ",h[3]]}))}),(0,o.jsxs)("html",{children:[(0,o.jsx)("img",{src:c,style:"width:400px;height:550px"}),(0,o.jsx)("div",{style:"position: absolute;top:20px;left:20px;width:200px;",children:k}),(0,o.jsx)("div",{style:"position: absolute;top:20px;left:220px;width:200px;",children:R})]})}),t.on("ready",async()=>{t.setInterval(async()=>{let b=await t.http.get(x),S=b.mine_rank.今日.高级,_=b.puzzle_rank.今日["4x4"],k=[(0,o.jsx)("div",{children:"扫雷联萌tapsss.com"}),(0,o.jsx)("div",{children:"扫雷高级日榜"}),(0,o.jsx)("br",{})];S.forEach((h,A)=>{k.push((0,o.jsxs)("div",{children:[h[0],". ",h[1]," ",h[3]]}))});let R=[(0,o.jsxs)("div",{children:["|",r.border,"|",b.update_time]}),(0,o.jsxs)("div",{children:["|",r.border,"|15p日榜"]}),(0,o.jsx)("br",{})];_.forEach((h,A)=>{R.push((0,o.jsxs)("div",{children:["|",r.border,"|",h[0],". ",h[1]," ",h[3]]}))});for(let{channelId:h,platform:A,selfId:D,guildId:C}of r.rules){if(!D){let I=await t.database.getChannel(A,h,["assignee","guildId"]);if(!I||!I.assignee)return;D=I.assignee,C=I.guildId}t.bots[`${A}:${D}`]?.sendMessage(h,(0,o.jsxs)("html",{children:[(0,o.jsx)("img",{src:c,style:"width:400px;height:550px"}),(0,o.jsx)("div",{style:"position: absolute;top:20px;left:20px;width:200px;",children:k}),(0,o.jsx)("div",{style:"position: absolute;top:20px;left:220px;width:200px;",children:R})]}),C)}},r.interval)})}v.apply=gt});export default xt();
