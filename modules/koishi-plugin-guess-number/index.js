var k=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var z=(t,n)=>()=>(t&&(n=t(t=0)),n);var A=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var v=(t,n,a,h)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of P(n))!R.call(t,e)&&e!==a&&k(t,e,{get:()=>n[e],enumerable:!(h=L(n,e))||h.enumerable});return t},x=(t,n,a)=>(v(t,n,"default"),a&&v(a,n,"default"));var U=t=>v(k({},"__esModule",{value:!0}),t);import{Buffer as I}from"https://registry.koishi.chat/modules/buffer/index.js";import _ from"https://registry.koishi.chat/modules/process/index.js";var m=z(()=>{});var f={};import*as V from"https://registry.koishi.chat/modules/koishi/index.js";var j=z(()=>{m();x(f,V)});var B=A((W,D)=>{D.exports={commands:{guess:{description:"猜数字",options:{base:"设置进制数",length:"设置答案长度",chances:"设置猜测次数",quit:"退出游戏"},usage:`输入要猜测的数字，将得到一个形如 xAyB 的匹配结果：
x 为本次猜测的四位数字中，答案包含的且所处位置正确的数字个数；
y 为本次猜测的四位数字中，答案包含的但所处位置不正确的数字个数。
例如：生成的数字为 0637，猜测 2730，则返回 1A2B。
这是因为 3 在答案中包含且位置正确，7 和 0 在答案中包含但位置不正确。`,messages:{idle:"没有正在进行的猜数字游戏。输入“猜数字”开始一轮游戏。",start:"{length} 位 {base} 进制猜数字游戏开始。",stop:"游戏结束。","invalid-base":"进制应为 2 到 36 之间的整数。","invalid-length":"长度应为不大于进制数的正整数。","invalid-chances":"猜测次数应为正整数。","history-empty":"本轮猜数字暂时没有历史记录。","history-item":"第 {3} 次猜测内容：{0}，匹配结果：{1}A{2}B",result:"数字 {0} 的匹配结果为：{1}A{2}B。",win:"恭喜 {0} 回答正确！",lose:"游戏失败！正确答案为：{answer}。","used-input":"该数字已经使用过，换一个叭~","expect-input":"请输入由不同数字构成的 {length} 位 {base} 进制数。"}}}}});var H=A(u=>{m();Object.defineProperty(u,"__esModule",{value:!0});u.apply=u.Config=u.name=u.reactive=void 0;var s=(j(),U(f));u.reactive=!0;u.name="guess-number";u.Config=s.Schema.object({base:s.Schema.number().default(10).description("标准开局下的进制数。"),length:s.Schema.number().default(4).description("标准开局下的答案长度。"),chances:s.Schema.number().default(10).description("标准开局下的猜测次数。")});function F(t,n){let a="",h=t.split("");for(let e=0;e<n;e++)a+=h.splice(Math.floor(Math.random()*h.length),1);return a}function G(t,n){let a=Object.create(null);t.i18n.define("zh",B());let h=t.command("guess [...number:string]").alias("csz").shortcut("猜数字",{fuzzy:!0}).option("base","-b <base>").option("length","-l <length>").option("chances","-c <count>").option("quit","-q",{notUsage:!0}).action(async({session:e,options:r},...d)=>{let c=e.channelId;if(!a[c]){if(d.length||r.quit)return e.text(".idle");if(!(0,s.isInteger)(r.base)||r.base<2||r.base>36)return e.text(".invalid-base");if(!(0,s.isInteger)(r.length)||r.length<1||r.length>r.base)return e.text(".invalid-length");if(!(0,s.isInteger)(r.chances)||r.chances<1)return e.text(".invalid-chances");let l="0123456789abcdefghijklmnopqrstuvwxyz".slice(0,r.base),g=F(l,r.length);return a[c]={answer:g,counter:Array(r.base).fill(0),history:[],base:r.base,length:r.length,chances:r.chances,regexp:new RegExp(`^[${l}]{${r.length}}$`)},e.text(".start",a[c])}let{answer:w,history:p,base:S,length:C,regexp:M,counter:O}=a[c];if(r.quit)return delete a[c],e.text(".stop");let q=!1,i=[];for(let l of d){l=l.toLowerCase();let g=l.split("");if(p.some(b=>b[0]===l))continue;if(!M.exec(l)||new Set(g).size!==l.length){q=!0;continue}let o=0,y=0;if(g.forEach((b,$)=>{let E=parseInt(b,S);O[E]+=1,b===w[$]?o+=1:w.indexOf(b)>=0&&(y+=1)}),p.push([l,o,y]),i.push(e.text(".result",[l,o,y])),o===C){i.push(e.text(".win",[e.username])),t.emit(e,"guess-number/win",a[c],i),delete a[c];break}else if(p.length>=a[c].chances){i.push(e.text(".lose",a[c])),t.emit(e,"guess-number/lose",a[c],i),delete a[c];break}}return i.length||(!d.length||q?(i.push(e.text(".expect-input",a[c])),d.length||(p.length?i.push(...p.map((l,g)=>e.text(".history-item",[...l,g+1]))):i.push(e.text(".history-empty")))):i.push(e.text(".used-input"))),i.join(`
`)});t.accept(e=>{h._options.base.fallback=e.base,h._options.length.fallback=e.length,h._options.chances.fallback=e.chances},{immediate:!0})}u.apply=G});export default H();
