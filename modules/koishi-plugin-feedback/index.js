var S=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var k=(e,t)=>()=>(e&&(t=e(e=0)),t);var v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var h=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of T(t))!$.call(e,a)&&a!==n&&S(e,a,{get:()=>t[a],enumerable:!(r=O(t,a))||r.enumerable});return e},b=(e,t,n)=>(h(e,t,"default"),n&&h(n,t,"default"));var z=e=>h(S({},"__esModule",{value:!0}),e);import{Buffer as w}from"https://registry.koishi.chat/modules/buffer/index.js";import I from"https://registry.koishi.chat/modules/process/index.js";var l=k(()=>{});var d={};import*as L from"https://registry.koishi.chat/modules/koishi/index.js";var x=k(()=>{l();b(d,L)});var q=v((N,B)=>{B.exports={commands:{feedback:{description:"发送反馈信息给作者",messages:{"expect-text":"请输入要发送的文本。",receive:`收到来自 {0} 的反馈信息：
{1}`,success:"反馈信息发送成功！"}}}}});var C=v(o=>{l();Object.defineProperty(o,"__esModule",{value:!0});o.apply=o.name=o.schema=void 0;var c=(x(),z(d));o.schema=c.Schema.union([c.Schema.object({operators:c.Schema.array(String).description("接收反馈信息的管理员。")}),c.Schema.transform(c.Schema.array(String),e=>({operators:e}))]);o.name="feedback";function F(e){let t=e.indexOf(":"),n=e.slice(0,t),r=e.slice(t+1);return[n,r]}function A(e,{operators:t=[],replyTimeout:n=c.Time.day}){e.i18n.define("zh",q());let r={};e.command("feedback <message:text>").userFields(["name","id"]).action(async({session:a},m)=>{if(!m)return a.text(".expect-text");let{username:f,userId:s}=a,i=f===""+s?s:`${f} (${s})`,M=a.text(".receive",[i,m]),g=e.root.config.delay.broadcast,P=[a.sid,a.channelId,a.guildId];for(let p=0;p<t.length;++p){p&&g&&await(0,c.sleep)(g);let[_,j]=F(t[p]);await e.bots.find(u=>u.platform===_).sendPrivateMessage(j,M).then(u=>{for(let y of u)r[y]=P,e.setTimeout(()=>delete r[y],n)},u=>{e.logger("bot").warn(u)})}return a.text(".success")}),e.middleware(async(a,m)=>{let{quote:f,parsed:s}=a;if(!s.content||!f)return m();let i=r[f.messageId];if(!i)return m();await e.bots[i[0]].sendMessage(i[1],s.content,i[2])})}o.apply=A});export default C();
