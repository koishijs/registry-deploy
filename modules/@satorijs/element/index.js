import{Buffer as E}from"https://registry.koishi.chat/modules/buffer/index.js";import tt from"https://registry.koishi.chat/modules/process/index.js";import{arrayBufferToBase64 as it,camelize as z,defineProperty as L,hyphenate as st,is as M,isNullable as _,makeArray as at}from"https://registry.koishi.chat/modules/cosmokit/index.js";var et=Object.defineProperty,rt=Object.getOwnPropertyNames,a=($,x)=>et($,"name",{value:x,configurable:!0}),nt=($,x)=>function(){return x||(0,$[rt($)[0]])((x={exports:{}}).exports,x),x.exports},ot=nt({"satori/packages/element/src/index.ts"($,x){var T=Symbol.for("satori.element");function P(t){return t&&typeof t=="object"&&t[T]}a(P,"isElement");function N(t){if(typeof t=="string"||typeof t=="number"||typeof t=="boolean"){if(t=""+t,t)return b("text",{content:t})}else{if(P(t))return t;if(!_(t))throw new TypeError(`Invalid content: ${t}`)}}a(N,"toElement");function R(t){return Array.isArray(t)?t.map(N).filter(f=>f):[N(t)].filter(f=>f)}a(R,"toElementArray");var k=class{get data(){return this.attrs}toString(t=!1){if(this.type==="text"&&"content"in this.attrs)return t?this.attrs.content:b.escape(this.attrs.content);let f=this.children.map(u=>u.toString(t)).join("");if(t)return f;let w=Object.entries(this.attrs).map(([u,g])=>_(g)?"":(u=st(u),g===!0?` ${u}`:g===!1?` no-${u}`:` ${u}="${b.escape(""+g,!0)}"`)).join("");return this.children.length?`<${this.type}${w}>${f}</${this.type}>`:`<${this.type}${w}/>`}};a(k,"ElementConstructor"),L(k,"name","Element"),L(k.prototype,T,!0);function b(t,...f){let w=Object.create(k.prototype),u={},g=[];if(f[0]&&typeof f[0]=="object"&&!P(f[0])&&!Array.isArray(f[0])){let A=f.shift();for(let[v,m]of Object.entries(A))_(m)||(v==="children"?f.push(...at(m)):u[v]=m)}for(let A of f)g.push(...R(A));return Object.assign(w,{type:t,attrs:u,children:g})}a(b,"Element");var Q=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(t=>{t.jsx=t,t.jsxs=t,t.jsxDEV=t,t.Fragment="template";function f(n,e){return typeof n!="string"?R(n):t.parse(n,e)}t.normalize=f,a(f,"normalize");function w(n,e=!1){let r=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e?r.replace(/"/g,"&quot;"):r}t.escape=w,a(w,"escape");function u(n){return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(e,r)=>r==="38"?e:String.fromCharCode(+r)).replace(/&#x([0-9a-f]+);/gi,(e,r)=>r==="26"?e:String.fromCharCode(parseInt(r,16))).replace(/&(amp|#38|#x26);/g,"&")}t.unescape=u,a(u,"unescape");function g(n,e={}){let r=j(n);return e.caret?e.type&&r[0]?.type!==e.type?void 0:r[0]:m(r,e.type||"*")[0]}t.from=g,a(g,"from");let A=/ *([ >+~]) */g;function v(n){return n.split(",").map(e=>{let r=[];e=e.trim();let s,p=" ";for(;s=A.exec(e);)r.push({type:e.slice(0,s.index),combinator:p}),p=s[1],e=e.slice(s.index+s[0].length);return r.push({type:e,combinator:p}),r})}t.parseSelector=v,a(v,"parseSelector");function m(n,e){if(!n||!e)return[];if(typeof n=="string"&&(n=j(n)),typeof e=="string"&&(e=v(e)),!e.length)return[];let r=[],s=[];for(let[p,l]of n.entries()){let h=[],c=[...e,...r];r=[];let d=!1;for(let i of c){let{type:o,combinator:y}=i[0];(o===l.type||o==="*")&&(i.length===1?d=!0:[" ",">"].includes(i[1].combinator)?h.push(i.slice(1)):i[1].combinator==="+"?r.push(i.slice(1)):e.push(i.slice(1))),y===" "&&h.push(i)}d&&s.push(n[p]),s.push(...m(l.children,h))}return s}t.select=m,a(m,"select");function B(n,e){if(n=n.trim(),!/^[\w.]+$/.test(n))return Q(n,e)??"";let r=e;for(let s of n.split("."))if(r=r[s],_(r))return"";return r??""}t.interpolate=B,a(B,"interpolate");let U=/<!--[\s\S]*?-->|<(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>/,X=/([^\s=]+)(?:="([^"]*)"|='([^']*)')?/g,Y=/([^\s=]+)(?:="([^"]*)"|='([^']*)'|=\{([^}]+)\})?/g,Z=/\{([^}]*)\}/;function j(n,e){let r=[];function s(i){i&&r.push(t("text",{content:i}))}a(s,"pushText");let p=e?Y:X,l;for(;l=U.exec(n);){h(n.slice(0,l.index));let[i,o,y,J,V]=l;if(n=n.slice(l.index+i.length),i.startsWith("<!"))continue;let O={source:i,type:y||t.Fragment,close:o,empty:V,attrs:{}},G;for(;G=p.exec(J);){let[ct,F,q,H=q,K]=G;K?O.attrs[z(F)]=B(K,e):_(H)?F.startsWith("no-")?O.attrs[z(F.slice(3))]=!1:O.attrs[z(F)]=!0:O.attrs[z(F)]=u(H)}r.push(O)}h(n);function h(i){if(i=i.replace(/^\s*\n\s*/,"").replace(/\s*\n\s*$/,""),e){let o;for(;o=Z.exec(i);){let[y,J]=o;s(u(i.slice(0,o.index))),i=i.slice(o.index+y.length);let V=B(J,e);r.push(...R(V))}}s(u(i))}a(h,"parseContent");let c=[t(t.Fragment)];function d(i){for(;i>0;i--){let{children:o}=c.shift(),{source:y}=c[0].children.pop();c[0].children.push(t("text",{content:y})),c[0].children.push(...o)}}a(d,"rollback");for(let i of r)if(P(i))c[0].children.push(i);else if(i.close){let o=0;for(;o<c.length&&c[o].type!==i.type;)o++;if(o===c.length)c[0].children.push(t("text",{content:i.source}));else{d(o);let y=c.shift();delete y.source}}else{let o=t(i.type,i.attrs);c[0].children.push(o),i.empty||(o.source=i.source,c.unshift(o))}return d(c.length-1),c[0].children}t.parse=j,a(j,"parse");function W(n,e,r){let{type:s,attrs:p,children:l}=n;if(typeof e=="function")return e(n,r);{let h=e[s]??e.default??!0;return typeof h=="function"&&(h=h(p,l,r)),h}}a(W,"visit");function I(n,e,r){let s=typeof n=="string"?j(n):n,p=[];return s.forEach(l=>{let{type:h,attrs:c,children:d}=l,i=W(l,e,r);i===!0?p.push(t(h,c,I(d,e,r))):i!==!1&&p.push(...f(i))}),typeof n=="string"?p.join(""):p}t.transform=I,a(I,"transform");async function D(n,e,r){let s=typeof n=="string"?j(n):n,p=(await Promise.all(s.map(async l=>{let{type:h,attrs:c,children:d}=l,i=await W(l,e,r);return i===!0?[t(h,c,await D(d,e,r))]:i!==!1?f(i):[]}))).flat(1);return typeof n=="string"?p.join(""):p}t.transformAsync=D,a(D,"transformAsync");function C(n,...e){return(...r)=>{let s=t(n);return e.forEach((p,l)=>{_(r[l])||(s.attrs[p]=r[l])}),r[e.length]&&Object.assign(s.attrs,r[e.length]),s}}a(C,"createFactory"),t.warn=a(()=>{},"warn");function S(n){return(e,...r)=>{let s="base64://";return typeof r[0]=="string"&&(s=`data:${r.shift()};base64,`),M("Buffer",e)?e=s+e.toString("base64"):M("ArrayBuffer",e)&&(e=s+it(e)),e.startsWith("base64://")&&(0,t.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),t(n,{...r[0],url:e})}}a(S,"createAssetFactory"),t.text=C("text","content"),t.at=C("at","id"),t.sharp=C("sharp","id"),t.quote=C("quote","id"),t.image=S("image"),t.video=S("video"),t.audio=S("audio"),t.file=S("file")})(b||(b={})),x.exports=b}}),ht=ot();export{ht as default};
