import{Buffer as E}from"https://registry.koishi.chat/modules/buffer/index.js";import x from"https://registry.koishi.chat/modules/process/index.js";import{camelize as N,capitalize as O,Context as y,Schema as H}from"https://registry.koishi.chat/modules/koishi/index.js";function A(e,r,n,s){var o,u=!1,d=0;function p(){o&&clearTimeout(o)}function m(){p(),u=!0}typeof r!="boolean"&&(s=n,n=r,r=void 0);function t(){for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];var g=this,v=Date.now()-d;if(u)return;function l(){d=Date.now(),n.apply(g,i)}function b(){o=void 0}s&&!o&&l(),p(),s===void 0&&v>e?l():r!==!0&&(o=setTimeout(s?b:l,s===void 0?e-v:e))}return t.cancel=m,t}function _(e,r,n){return n===void 0?A(e,r,!1):A(e,n,r!==!1)}import{DataService as K}from"https://registry.koishi.chat/modules/@koishijs/plugin-console/index.js";import"https://registry.koishi.chat/modules/path-browserify/index.js";var D=Object.defineProperty,f=(e,r)=>D(e,"name",{value:r,configurable:!0});function S(e){return O(N(e))}f(S,"format");function w(e){return e?!e.name||e.name==="apply"?"Anonymous":S(e.name):"App"}f(w,"getName");function I(e){let{state:r}=e.parent;return r.runtime.isForkable?r.uid:r.runtime.uid}f(I,"getSourceId");var h=class extends K{constructor(e){super(e,"insight"),e.console.addEntry(["https://registry.koishi.chat/modules/@koishijs/plugin-insight/dist/index.js","https://registry.koishi.chat/modules/@koishijs/plugin-insight/dist/style.css"]),e.on("internal/fork",this.update),e.on("internal/runtime",this.update),e.on("internal/service",this.update),e.on("internal/status",this.update)}stop(){this.update.cancel()}update=_(0,()=>{this.refresh()});async get(){let e=[],r=[];for(let n of this.ctx.registry.values()){let s=function(t){return!0},o=function(t){let{uid:a,alias:i,disposables:c,status:g}=t,v=c.length,l={uid:a,name:p,weight:v,status:g};i&&(l.name+=` <${S(i)}>`),e.push(l)},u=function(t,a,i){r.push({type:t,source:a,target:i})},d=function(t){for(let a of n.using){let i=t.ctx[a]?.[y.source]?.state.uid;i&&u("dashed",i,t.uid)}};f(s,"isActive"),f(o,"addNode"),f(u,"addEdge"),f(d,"addDeps");let p=w(n.plugin),m=n.plugin?.reusable;if(!m){if(!s(n))continue;o(n),d(n)}for(let t of n.children)if(n.isForkable){if(!s(t))continue;o(t),u("solid",I(t),t.uid),m?d(t):u("solid",t.uid,n.uid)}else e[e.length-1].weight+=t.disposables.length,u("solid",I(t),n.uid)}return{nodes:e,edges:r}}};f(h,"Insight");(e=>{e.filter=!1,e.using=["console"],e.Config=H.object({})})(h||(h={}));var G=h;export{G as default};
