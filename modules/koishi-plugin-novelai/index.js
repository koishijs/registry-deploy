var he=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var Ue=Object.getOwnPropertyNames;var Oe=Object.prototype.hasOwnProperty;var fe=(r,e)=>()=>(r&&(e=r(r=0)),e);var x=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var ee=(r,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of Ue(e))!Oe.call(r,l)&&l!==n&&he(r,l,{get:()=>e[l],enumerable:!(s=Ce(e,l))||s.enumerable});return r},$=(r,e,n)=>(ee(r,e,"default"),n&&ee(n,e,"default"));var te=r=>ee(he({},"__esModule",{value:!0}),r);import{Buffer as M}from"https://registry.koishi.chat/modules/buffer/index.js";import G from"https://registry.koishi.chat/modules/process/index.js";var _=fe(()=>{});var F={};import*as yt from"https://registry.koishi.chat/modules/koishi/index.js";var H=fe(()=>{_();$(F,yt)});var ge=x((_t,Ke)=>{Ke.exports=["colorbook","Papercutcraft","Xynthii-Diffusion","Redshift Diffusion","Mega Merge Diffusion","Borderlands","Voxel Art Diffusion","Elden Ring Diffusion","Cyberpunk Anime Diffusion","Future Diffusion","Microworlds","Vintedois Diffusion","mo-di-diffusion","Min Illust Background","Robo-Diffusion","stable_diffusion_inpainting","Dawgsmix","Zeipher Female Model","AIO Pixel Art","Dungeons and Diffusion","trinart","Yiffy","Midjourney PaintArt","App Icon Diffusion","Smoke Diffusion","Inkpunk Diffusion","Supermarionation","DnD Item","Zack3D","Fantasy Card Diffusion","stable_diffusion","Synthwave","Furry Epoch","Asim Simpsons","PortraitPlus","Anything Diffusion","Tron Legacy Diffusion","Clazy","Valorant Diffusion","Stable Diffusion 2 Depth","Papercut Diffusion","ChromaV5","stable_diffusion_2.1","Archer Diffusion","Dark Victorian Diffusion","Guohua Diffusion","Analog Diffusion","vectorartz","Classic Animation Diffusion","Eimis Anime Diffusion","Ranma Diffusion","Microscopic","Dreamlike Diffusion","GTA5 Artwork Diffusion","Midjourney Diffusion","Poison","kurzgesagt","Samdoesarts Ultmerge","Dreamlike Photoreal","Trinart Characters","Arcane Diffusion","JWST Deep Space Diffusion","RPG","Hassanblend","waifu_diffusion","ModernArt Diffusion","Darkest Diffusion","Balloon Art","Comic-Diffusion","BubblyDubbly","Eternos","Van Gogh Diffusion","Double Exposure Diffusion","Squishmallow Diffusion","Funko Diffusion","Hentai Diffusion","Ghibli Diffusion","Seek.art MEGA","Knollingcase","Spider-Verse Diffusion","ACertainThing","Wavyfusion","Nitro Diffusion"]});var ae=x(c=>{"use strict";_();Object.defineProperty(c,"__esModule",{value:!0});c.parseInput=c.parseForbidden=c.Config=c.PromptConfig=c.upscalers=c.sampler=c.orients=c.models=c.hordeModels=c.orientMap=c.modelMap=void 0;var t=(H(),te(F)),b={userFields:["authority"]};c.modelMap={safe:"safe-diffusion",nai:"nai-diffusion",furry:"nai-diffusion-furry"};c.orientMap={landscape:{height:512,width:768},portrait:{height:768,width:512},square:{height:640,width:640}};c.hordeModels=ge();var Ge=["nsfw, lowres, bad anatomy, bad hands, text, error, missing fingers","extra digit, fewer digits, cropped, worst quality, low quality","normal quality, jpeg artifacts, signature, watermark, username, blurry"].join(", ");c.models=Object.keys(c.modelMap);c.orients=Object.keys(c.orientMap);var T;(function(r){r.nai={k_euler_a:"Euler ancestral",k_euler:"Euler",k_lms:"LMS",ddim:"DDIM",plms:"PLMS"},r.sd={k_euler_a:"Euler a",k_euler:"Euler",k_lms:"LMS",k_heun:"Heun",k_dpm_2:"DPM2",k_dpm_2_a:"DPM2 a",k_dpmpp_2s_a:"DPM++ 2S a",k_dpmpp_2m:"DPM++ 2M",k_dpm_fast:"DPM fast",k_dpm_ad:"DPM adaptive",k_dpmpp_sde:"DPM++ SDE",k_lms_ka:"LMS Karras",k_dpm_2_ka:"DPM2 Karras",k_dpm_2_a_ka:"DPM2 a Karras",k_dpmpp_2s_a_ka:"DPM++ 2S a Karras",k_dpmpp_2m_ka:"DPM++ 2M Karras",k_dpmpp_sde_ka:"DPM++ SDE Karras",ddim:"DDIM",plms:"PLMS"},r.horde={k_lms:"LMS",k_heun:"Heun",k_euler:"Euler",k_euler_a:"Euler a",k_dpm_2:"DPM2",k_dpm_2_a:"DPM2 a",k_dpm_fast:"DPM fast",k_dpm_adaptive:"DPM adaptive",k_dpmpp_2m:"DPM++ 2M",k_dpmpp_2s_a:"DPM++ 2S a",k_lms_ka:"LMS Karras",k_heun_ka:"Heun Karras",k_euler_ka:"Euler Karras",k_euler_a_ka:"Euler a Karras",k_dpm_2_ka:"DPM2 Karras",k_dpm_2_a_ka:"DPM2 a Karras",k_dpm_fast_ka:"DPM fast Karras",k_dpm_adaptive_ka:"DPM adaptive Karras",k_dpmpp_2m_ka:"DPM++ 2M Karras",k_dpmpp_2s_a_ka:"DPM++ 2S a Karras"};function e(s){return t.Schema.union(Object.entries(s).map(([l,h])=>t.Schema.const(l).description(h))).description("默认的采样器。").default("k_euler_a")}r.createSchema=e;function n(s){return s==="k_euler_a"?"k_euler_ancestral":s in r.nai?s:"k_euler_ancestral"}r.sd2nai=n})(T=c.sampler||(c.sampler={}));c.upscalers=["None","Lanczos","Nearest","LDSR","ESRGAN_4x","R-ESRGAN General 4xV3","R-ESRGAN General WDN 4xV3","R-ESRGAN AnimeVideo","R-ESRGAN 4x+","R-ESRGAN 4x+ Anime6B","R-ESRGAN 2x+","ScuNET GAN","ScuNET PSNR","SwinIR 4x"];c.PromptConfig=t.Schema.object({basePrompt:t.Schema.computed(t.Schema.string().role("textarea"),b).description("默认附加的标签。").default("masterpiece, best quality"),negativePrompt:t.Schema.computed(t.Schema.string().role("textarea"),b).description("默认附加的反向标签。").default(Ge),forbidden:t.Schema.computed(t.Schema.string().role("textarea"),b).description("违禁词列表。请求中的违禁词将会被自动删除。").default(""),placement:t.Schema.computed(t.Schema.union([t.Schema.const("before").description("置于最前"),t.Schema.const("after").description("置于最后")]),b).description("默认附加标签的位置。").default("after"),translator:t.Schema.boolean().description("是否启用自动翻译。").default(!0),latinOnly:t.Schema.computed(t.Schema.boolean(),b).description("是否只接受英文输入。").default(!1),maxWords:t.Schema.computed(t.Schema.natural(),b).description("允许的最大单词数量。").default(0)}).description("输入设置");var Be=t.Schema.object({anlas:t.Schema.computed(t.Schema.boolean(),b).default(!0).description("是否允许使用点数。")}),Ve=t.Schema.object({upscale:t.Schema.computed(t.Schema.boolean(),b).default(!0).description("是否启用图片放大。")}),re=t.Schema.object({text:t.Schema.computed(t.Schema.boolean(),b).default(!0).description("是否启用文本转图片。"),image:t.Schema.computed(t.Schema.boolean(),b).default(!0).description("是否启用图片转图片。")});c.Config=t.Schema.intersect([t.Schema.object({type:t.Schema.union([t.Schema.const("token").description("授权令牌"),t.Schema.const("naifu").description("naifu"),t.Schema.const("sd-webui").description("sd-webui"),t.Schema.const("stable-horde").description("Stable Horde")]).default("token").description("登录方式。")}).description("登录设置"),t.Schema.union([t.Schema.intersect([t.Schema.union([t.Schema.object({type:t.Schema.const("token"),token:t.Schema.string().description("授权令牌。").role("secret").required()}),t.Schema.object({type:t.Schema.const("login"),email:t.Schema.string().description("账号邮箱。").required(),password:t.Schema.string().description("账号密码。").role("secret").required()})]),t.Schema.object({endpoint:t.Schema.string().description("API 服务器地址。").default("https://api.novelai.net"),headers:t.Schema.dict(String).role("table").description("要附加的额外请求头。").default({referer:"https://novelai.net/","user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36"})})]),t.Schema.object({type:t.Schema.const("naifu"),token:t.Schema.string().description("授权令牌。").role("secret"),endpoint:t.Schema.string().description("API 服务器地址。").required(),headers:t.Schema.dict(String).role("table").description("要附加的额外请求头。")}),t.Schema.object({type:t.Schema.const("sd-webui"),endpoint:t.Schema.string().description("API 服务器地址。").required(),headers:t.Schema.dict(String).role("table").description("要附加的额外请求头。")}),t.Schema.object({type:t.Schema.const("stable-horde"),endpoint:t.Schema.string().description("API 服务器地址。").default("https://stablehorde.net/"),token:t.Schema.string().description("授权令牌 (API Key)。").role("secret").default("0000000000"),nsfw:t.Schema.union([t.Schema.const("disallow").description("禁止"),t.Schema.const("censor").description("屏蔽"),t.Schema.const("allow").description("允许")]).description("是否允许 NSFW 内容。").default("allow"),trustedWorkers:t.Schema.boolean().description("是否只请求可信任工作节点。").default(!1),pollInterval:t.Schema.number().role("time").description("轮询进度间隔时长。").default(t.Time.second)})]),t.Schema.object({features:t.Schema.object({})}).description("功能设置"),t.Schema.union([t.Schema.object({type:t.Schema.union(["token","login"]).hidden(),features:t.Schema.intersect([Be,re])}),t.Schema.object({type:t.Schema.const("sd-webui"),features:t.Schema.intersect([re,Ve])}),t.Schema.object({features:t.Schema.intersect([re])})]),t.Schema.object({}).description("参数设置"),t.Schema.union([t.Schema.object({type:t.Schema.const("sd-webui"),sampler:T.createSchema(T.sd),upscaler:t.Schema.union(c.upscalers).description("默认的放大算法。").default("Lanczos"),restoreFaces:t.Schema.boolean().description("是否启用人脸修复。").default(!1),hiresFix:t.Schema.boolean().description("是否启用高分辨率修复。").default(!1)}),t.Schema.object({type:t.Schema.const("stable-horde"),sampler:T.createSchema(T.horde),model:t.Schema.union(c.hordeModels)}),t.Schema.object({type:t.Schema.const("naifu"),sampler:T.createSchema(T.nai)}),t.Schema.object({model:t.Schema.union(c.models).description("默认的生成模型。").default("nai"),sampler:T.createSchema(T.nai)})]),t.Schema.object({scale:t.Schema.computed(t.Schema.number(),b).description("默认对输入的服从度。").default(11),textSteps:t.Schema.computed(t.Schema.natural(),b).description("文本生图时默认的迭代步数。").default(28),imageSteps:t.Schema.computed(t.Schema.natural(),b).description("以图生图时默认的迭代步数。").default(50),maxSteps:t.Schema.computed(t.Schema.natural(),b).description("允许的最大迭代步数。").default(64),resolution:t.Schema.computed(t.Schema.union([t.Schema.const("portrait").description("肖像 (768x512)"),t.Schema.const("landscape").description("风景 (512x768)"),t.Schema.const("square").description("方形 (640x640)"),t.Schema.object({width:t.Schema.natural().description("图片宽度。").default(640),height:t.Schema.natural().description("图片高度。").default(640)}).description("自定义")]),b).description("默认生成的图片尺寸。").default("portrait"),maxResolution:t.Schema.computed(t.Schema.natural(),b).description("允许生成的宽高最大值。").default(1024)}),c.PromptConfig,t.Schema.object({output:t.Schema.union([t.Schema.const("minimal").description("只发送图片"),t.Schema.const("default").description("发送图片和关键信息"),t.Schema.const("verbose").description("发送全部信息")]).description("输出方式。").default("default"),maxIterations:t.Schema.natural().description("允许的最大绘制次数。").default(1),maxRetryCount:t.Schema.natural().description("连接失败时最大的重试次数。").default(3),requestTimeout:t.Schema.number().role("time").description("当请求超过这个时间时会中止并提示超时。").default(t.Time.minute),recallTimeout:t.Schema.number().role("time").description("图片发送后自动撤回的时间 (设置为 0 以禁用此功能)。").default(0),maxConcurrency:t.Schema.number().description("单个频道下的最大并发数量 (设置为 0 以禁用此功能)。").default(0)}).description("高级设置")]);function we(r){return r.trim().toLowerCase().replace(/，/g,",").replace(/！/g,"!").split(/(?:,\s*|\s*\n\s*)/g).filter(Boolean).map(e=>{let n=e.endsWith("!");return n&&(e=e.slice(0,-1)),e=e.replace(/[^a-z0-9]+/g," ").trim(),{pattern:e,strict:n}})}c.parseForbidden=we;var Se=/@@__BACKSLASH__@@/g;function We(r,e,n,s){if(e=e.toLowerCase().replace(/\\\\/g,Se.source).replace(/，/g,",").replace(/（/g,"(").replace(/）/g,")"),n.type==="sd-webui"?e=e.split("\\{").map(f=>f.replace(/\{/g,"(")).join("\\{").split("\\}").map(f=>f.replace(/\}/g,")")).join("\\}"):e=e.split("\\(").map(f=>f.replace(/\(/g,"{")).join("\\(").split("\\)").map(f=>f.replace(/\)/g,"}")).join("\\)"),e=e.replace(Se,"\\").replace(/_/g," "),r.resolve(n.latinOnly)&&/[^\s\w"'“”‘’.,:|\\()\[\]{}<>-]/.test(e))return[".latin-only"];let l=[],h=r.resolve(n.placement),w=(f,I)=>{let R=I.split(/,\s*/g);h==="before"&&R.reverse();for(let j of R)j=j.trim().toLowerCase(),!(!j||f.includes(j))&&(h==="before"?f.unshift(j):f.push(j))},A=e.match(/(,\s*|\s+)(-u\s+|--undesired\s+|negative prompts?:\s*)([\s\S]+)/m);A?.[3]&&(e=e.slice(0,A.index).trim(),w(l,A[3]));let L=we(r.resolve(n.forbidden)),D=e.split(/,\s*/g).filter(f=>{if(f=f.replace(/[\x00-\x7f]/g,I=>I.replace(/[^0-9a-zA-Z]/," ")).replace(/\s+/," ").trim(),!f)return!1;for(let{pattern:I,strict:R}of L){if(R&&f.split(/\W+/g).includes(I))return!1;if(!R&&f.includes(I))return!1}return!0});return Math.max(be(D),be(l))>(r.resolve(n.maxWords)||1/0)?[".too-many-words"]:(s||(w(D,r.resolve(n.basePrompt)),w(l,r.resolve(n.negativePrompt))),[null,D.join(", "),l.join(", ")])}c.parseInput=We;function be(r){return r.join(" ").replace(/[^a-z0-9]+/g," ").trim().split(" ").length}});var ye=x(()=>{_()});var _e=x(()=>{_()});var ke=x(m=>{"use strict";_();var $e=m&&m.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(m,"__esModule",{value:!0});m.forceDataPrefix=m.resizeInput=m.closestMultiple=m.login=m.NetworkError=m.calcEncryptionKey=m.calcAccessKey=m.download=m.getImageSize=m.project=void 0;var ne=(H(),te(F)),P=ye(),He=$e(_e());function Ye(r,e){let n={};for(let s in e)n[s]=r[e[s]];return n}m.project=Ye;function Ze(r){if(typeof M<"u")return(0,He.default)(M.from(r));let e=new Blob([r]),n=new Image;return n.src=URL.createObjectURL(e),(0,ne.pick)(n,["width","height"])}m.getImageSize=Ze;var ie=1048576,Qe=10485760,ve=["image/jpeg","image/png"];async function Xe(r,e,n={}){if(e.startsWith("data:")){let[,s,l]=e.match(/^data:(image\/\w+);base64,(.*)$/);if(!ve.includes(s))throw new q(".unsupported-file-type");let h=atob(l),w=new Uint8Array(h.length);for(let A=0;A<h.length;A++)w[A]=h.charCodeAt(A);return{buffer:w,base64:l,dataUrl:e}}else{let s=await r.http.head(e,{headers:n});if(+s["content-length"]>Qe)throw new q(".file-too-large");let l=s["content-type"];if(!ve.includes(l))throw new q(".unsupported-file-type");let h=await r.http.get(e,{responseType:"arraybuffer",headers:n}),w=(0,ne.arrayBufferToBase64)(h);return{buffer:h,base64:w,dataUrl:`data:${l};base64,${w}`}}}m.download=Xe;async function Je(r,e){return await P.ready,(0,P.crypto_pwhash)(64,new Uint8Array(M.from(e)),(0,P.crypto_generichash)(P.crypto_pwhash_SALTBYTES,e.slice(0,6)+r+"novelai_data_access_key"),2,2e6,P.crypto_pwhash_ALG_ARGON2ID13,"base64").slice(0,64)}m.calcAccessKey=Je;async function et(r,e){return await P.ready,(0,P.crypto_pwhash)(128,new Uint8Array(M.from(e)),(0,P.crypto_generichash)(P.crypto_pwhash_SALTBYTES,e.slice(0,6)+r+"novelai_data_encryption_key"),2,2e6,P.crypto_pwhash_ALG_ARGON2ID13,"base64")}m.calcEncryptionKey=et;var q=class extends Error{constructor(e,n={}){super(e),this.params=n}};m.NetworkError=q;q.catch=r=>e=>{if(ne.Quester.isAxiosError(e)){let n=e.response?.status;for(let s in r)if(n===+s)throw new q(r[s])}throw e};async function tt(r){return r.config.type==="token"?(await r.http.get(r.config.endpoint+"/user/subscription",{timeout:3e4,headers:{authorization:"Bearer "+r.config.token}}).catch(q.catch({401:".invalid-token"})),r.config.token):(r.config.type,r.config.token)}m.login=tt;function W(r,e=64){let n=Math.floor(r/e)*e,s=Math.ceil(r/e)*e,l=r-n<s-r?n:s;return Number.isNaN(l)?0:l<=0?e:l}m.closestMultiple=W;function rt(r){let{width:e,height:n}=r;if(e%64===0&&n%64===0&&e*n<=ie)return{width:e,height:n};let s=e/n;if(s>1){let h=W(512*s);if(h*512<=ie)return{width:h,height:512}}else{let h=W(512/s);if(512*h<=ie)return{width:512,height:h}}return s>1?{width:1024,height:W(1024/s)}:{width:W(1024*s),height:1024}}m.resizeInput=rt;function at(r,e="image/png"){return r.startsWith("data:")?r:`data:${e};base64,`+r}m.forceDataPrefix=at});var De=x((Et,it)=>{it.exports={commands:{novelai:{description:"AI 画图",usage:`输入用逗号隔开的英文标签，例如 Mr.Quin, dark sword, red eyes。
查找标签可以使用 Danbooru。
快来给仓库点个 star 吧：https://github.com/koishijs/novelai-bot`,shortcuts:{imagine:"画画|约稿",enhance:"增强"},options:{enhance:"图片增强模式",model:"设定生成模型",resolution:"设定图片尺寸",override:"禁用默认标签",sampler:"设置采样器",seed:"设置随机种子",steps:"设置迭代步数",scale:"设置对输入的服从度",strength:"图片修改幅度",noise:"图片噪声强度",hiresFix:"启用高分辨率修复",undesired:"排除标签",noTranslator:"禁用自动翻译",iterations:"设置绘制次数"},messages:{"exceed-max-iteration":"超过最大绘制次数。","expect-prompt":"请输入标签。","expect-image":"请输入图片。","too-many-images":"过多的图片。","invalid-content":"输入中含有无效内容。","latin-only":"只接受英文输入。","too-many-words":"输入的单词数量过多。","forbidden-word":"输入含有违禁词。","concurrent-jobs":`<random>
  <>等会再约稿吧，我已经忙不过来了……</>
  <>是数位板没电了，才…才不是我不想画呢！</>
  <>那你得先教我画画（理直气壮</>
</random>`,waiting:`<random>
  <>少女绘画中……</>
  <>在画了在画了</>
  <>你就在此地不要走动，等我给你画一幅</>
</random>`,pending:"在画了在画了，不过前面还有 {0} 个稿……","invalid-size":"增强功能仅适用于被生成的图片。普通的 img2img 请直接使用「约稿」而不是「增强」。","invalid-resolution":"非法的图片尺寸。宽高必须都为 64 的倍数。","custom-resolution-unsupported":"不支持自定义图片尺寸。","file-too-large":"文件体积过大。","unsupported-file-type":"不支持的文件格式。","download-error":"图片解析失败。","unknown-error":"发生未知错误。","response-error":"发生未知错误 ({0})。","empty-response":"服务器返回了空白图片，请稍后重试。","request-failed":"请求失败 ({0})，请稍后重试。","request-timeout":"请求超时。","invalid-password":"邮箱或密码错误。","invalid-token":"令牌无效或已过期，请联系管理员。",unauthorized:"令牌未授权，可能需要续费，请联系管理员。"}},"novelai.upscale":{description:"AI 放大图片",shortcuts:{upscale:"放大"},options:{scale:"设置放大倍数",resolution:"设定放大尺寸",crop:"是否裁剪以适应尺寸",upscaler:"设置放大模型",upscaler2:"设置放大模型 2",upscaler2visibility:"设置放大模型 2 的可见度",upscaleFirst:"先放大再执行面部修复"},messages:{"expect-image":"请输入图片。","download-error":"图片解析失败。","unknown-error":"发生未知错误。"}}}}});var xe=x((Tt,nt)=>{nt.exports={commands:{novelai:{description:"AI 繪圖",usage:`輸入以逗號分割的英文提示詞，例如 portrait, blonde hair, red eyes。
查找可用的提示詞標籤可以使用 Danbooru。
快來給專案標星收藏吧：https://github.com/koishijs/novelai-bot`,shortcuts:{imagine:"畫畫|約稿",enhance:"增強"},options:{enhance:"圖像增強模式",model:"設定生成模型",resolution:"設定圖像尺寸",override:"禁用預設標籤",sampler:"設定採樣器",seed:"設定隨機種子",steps:"設定迭代步數",scale:"設定提示詞的相關性",strength:"圖像修改幅度",noise:"圖像雜訊強度",hiresFix:"啟用高分辨率修復",undesired:"反向提示詞",noTranslator:"禁用自動翻譯",iterations:"設定繪畫次數"},messages:{"exceed-max-iteration":"超過最大繪畫次數","expect-prompt":"請輸入提示詞。","expect-image":"請輸入圖像。","latin-only":"僅接受英文提示詞。","too-many-words":"輸入的提示詞數量過多","forbidden-word":"提示詞中含有違禁詞彙。","concurrent-jobs":`<random>
  <>等下再畫吧，我已經忙不過來了……</>
  <>我…我纔不是不會畫畫，只是沒時間！</>
  <>我先喝杯咖啡可以嗎，好睏～</>
</random>`,waiting:`<random>
  <>少女繪畫中</>
  <>莫行開，我即時來畫！</>
</random>`,pending:"好酒沉甕底。您還需等我完成前面 {0} 個稿件。","invalid-size":"增強功能僅適用於 Novel AI 生成圖。若要使用 img2img 功能請直接使用「約稿」而非「增強」。","invalid-resolution":"圖像尺寸無效。寬度與高度都須爲 64 的倍數。","custom-resolution-unsupported":"不支援自訂圖像尺寸。","file-too-large":"文件體積過大。","unsupported-file-type":"不支援的檔案格式。","download-error":"圖像解析失敗。","unknown-error":"發生未知的錯誤。","response-error":"發生未知的錯誤 ({0})。","empty-response":"伺服器返回了空圖像，請稍後重試。","request-failed":"擷取資料失敗 ({0})，請稍後重試。","request-timeout":"擷取資料超時。","invalid-password":"電郵地址或密碼不正確。","invalid-token":"令牌無效或已過期，請聯繫管理員。",unauthorized:"令牌未經授權，可能關聯帳戶需要續費，請聯繫管理員。"}},"novelai.upscale":{description:"AI 放大圖像",shortcuts:{upscale:"放大"},options:{scale:"設定放大倍率",resolution:"設定放大尺寸",crop:"是否裁剪以適應尺寸",upscaler:"設定放大模型",upscaler2:"設定放大模型 2",upscaler2visibility:"設定放大模型 2 的可視度",upscaleFirst:"先放大再執行面部修復"},messages:{"expect-image":"請輸入圖像。","download-error":"圖像解析失敗。","unknown-error":"發生未知的錯誤。"}}}}});var Me=x((qt,st)=>{st.exports={commands:{novelai:{description:"Generate Images from Novel AI",usage:`Enter "novelai" with English prompt or tags, e.g. a girl in the forest, blonde hair, red eyes, white dress, etc.
You can also use comma separated tags like those on Danbooru.
Star it: https://github.com/koishijs/novelai-bot`,options:{enhance:"Image Enhance Mode",model:"Set Model for Generation",resolution:"Set Image Resolution",override:"Disable Default Prompts",sampler:"Set Sampler",seed:"Set Random Seed",steps:"Set Iteration Steps",scale:"Set CFG Scale",strength:"Set Denoising Strength",noise:"Set Noising Strength",hiresFix:"Enable Hires Fix.",undesired:"Negative Prompt",noTranslator:"Disable Auto Translation",iterations:"Set Batch Count."},messages:{"exceed-max-iteration":"Exceeded max batch count.","expect-prompt":"Expect a prompt.","expect-image":"Expect an image.","latin-only":"Invalid prompt, only English words can be used.","too-many-words":"Too many words in prompt.","forbidden-word":"Forbidden words in prompt.","concurrent-jobs":`<random>
  <>Too busy to handle your request...</>
  <>Brb power nap :zzz:</>
  <>(*~*) Have no time to draw a new one.</>
</random>`,waiting:`<random>
  <>The illustrator starts painting.</>
  <>Monet and Da Vinci, whose style is better for this?</>
</random>`,pending:`<plural count={0}>
  <>Sure.</>
  <>Sure, but please wait for me to complete this one before.</>
  <>Bruh, there are {0} jobs pending!</>
</plural>`,"invalid-size":'The Enhance mode can only be used for images generated. Use "novelai" without enhance option if you are using normal img2img.',"invalid-resolution":"Invalid resolution for image generation. The width and height of image should be multiple of 64.","custom-resolution-unsupported":"Custom resolution is not supported.","file-too-large":"File is too large.","unsupported-file-type":"Unsupported file type.","download-error":"Parsing image failed.","unknown-error":"An unknown error occurred.","response-error":"An unknown error occurred ({0}).","empty-response":"The server didn't return a valid image.","request-failed":"Request failed ({0}).","request-timeout":"Request timeout.","invalid-password":"Incorrect email address or password.","invalid-token":"The token is invalid or expired. Please contact your administrator.",unauthorized:"The token is unauthorized, this happens while your account didn't have a valid subscription. Please contact your administrator."}},"novelai.upscale":{description:"Upscale Images by AI",options:{scale:"Set Upscale By",resolution:"Set Upscale To",crop:"Crop Image Before Upscaling",upscaler:"Set Upscaler",upscaler2:"Set Upscaler",upscaler2visibility:"Set Visibility of Upscaler 2",upscaleFirst:"Upscale Image Before Restoring Face"},messages:{"expect-image":"Expect an image.","download-error":"Parsing image failed.","unknown-error":"An unknown error occurred."}}}}});var Ae=x((Ft,ot)=>{ot.exports={commands:{novelai:{description:"Générer des images sur IA",usage:`Entrez « novelai » avec les descriptions textuelles (anglais : prompt) de la scène que vous souhaitez générer.
De nombreux modèles exigent que les descriptions textuelles soient en anglais, par ex. a girl in the forest, blonde hair, red eyes, white dress.
Vous pouvez utiliser des balises séparées par des virgules, comme sur Danbooru.
Donnez-lui une étoile : https://github.com/koishijs/novelai-bot`,options:{enhance:"Mode d'amélioration de l'image",model:"Définir le modèle pour la génération",resolution:"Définir la taille de l'image",override:"Remplacer les descriptions textuelles de base",sampler:"Définir l'échantillonneur",seed:"Définir la graine aléatoire",steps:"Définir les étapes de l'itération",scale:"Définir CFG Scale",strength:"Définir l'intensité du débruitage",noise:"Définir l'intensité du bruit",hiresFix:"Activer la correction pour la résolution haute.",undesired:"Définir les descriptions textuelles négatives",noTranslator:"Désactiver la traduction automatique",iterations:"Définir le nombre des générations"},messages:{"exceed-max-iteration":"Trop du nombre des générations.","expect-prompt":"Attendrez-vous les descriptions textuelles valides.","expect-image":"Attendrez-vous une image.","latin-only":"Les descriptions textuelles ne sont pas valides, vous ne pouvez utiliser que des mots anglais.","too-many-words":"Trop de mots saisis.","forbidden-word":"Les descriptions textuelles contiennent des mots prohibés.","concurrent-jobs":`<random>
  <>Trop occupé pour répondre à votre demande...</>
  <>Courte sieste :zzz:</>
  <>(*~*) Pas le temps d'en dessiner un nouveau.</>
</random>`,waiting:`<random>
  <>D'accord. Je dessine de belles images pour vous.</>
  <>Votre demande est en cours de génération, veuillez attendre un moment.</>
  <>L'illustrateur commence à peindre.</>
  <>Monet et Da Vinci, quel style convient le mieux à cette image ?</>
</random>`,pending:`<plural count={0}>
  <>D'accord.</>
  <>D'accord, mais attendez que je complète la dernière demande.</>
  <>>_< Il y a {0} travaux en cours.</>
</plural>`,"invalid-size":"Le mode d'amélioration de l'image peut être utilisé seulement pour les images générées. Si vous utilisez le mode de img2img, utilisez « novelai » sans l'option « --enhance ».","invalid-resolution":"La taille de l'image n'est pas valide. La largeur et la hauteur de l'image doivent être des multiples de 64.","custom-resolution-unsupported":"La personnalisation de la résolution n'est pas prise en charge.","file-too-large":"Le fichier est trop important.","unsupported-file-type":"Le format de fichier non reconnu.","download-error":"Une erreur d'analyse syntaxique de l'image s'est produite.","unknown-error":"Une erreur inconnue s'est produite.","response-error":"Une erreur inconnue s'est produite : ({0}).","empty-response":"Le serveur répond avec l'image invalide.","request-failed":"La demande a échoué : ({0}).","request-timeout":"Le délai d'attente de la demande dépassé.","invalid-password":"L'adresse électronique ou mot de passe introduit est incorrect.","invalid-token":"Le token est invalide ou a expiré. Veuillez contacter l'administrateur.",unauthorized:"Le token n'est pas autorisé, peut-être que ce token n'a pas d'abonnement valide. Veuillez contacter l'administrateur."}},"novelai.upscale":{description:"Agrandir des images sur IA",options:{scale:"Mise à l'échelle de",resolution:"Mise à l'échelle à",crop:"Recadrer à la taille avant de l'agrandissement.",upscaler:"Définir l'agrandisseur",upscaler2:"Définir l'agrandisseur 2",upscaler2visibility:"Définir la visibilité de l'agrandisseur 2",upscaleFirst:"Agrandir les images avant de restaurer les visages"},messages:{"expect-image":"Attendrez-vous une image.","download-error":"Une erreur d'analyse syntaxique de l'image s'est produite.","unknown-error":"Une erreur inconnue s'est produite."}}}}});var Pe=x((Lt,lt)=>{lt.exports={commands:{novelai:{description:"AI で絵を描く",usage:`コンマで区切られた英語の生成呪文 (プロンプト) を入力してください。例：1girl, red eyes, black hair。
モデルに用いられる単語は Danbooru のタグとほとんど同じです。
興味があったら、レポジトリにスターを付けてください：https://github.com/koishijs/novelai-bot`,options:{enhance:"向上 (enhance) モードを有効",model:"モデルを指定",resolution:"画像解像度を設定",override:"デフォルトプロンプトを無効にする",sampler:"サンプラーを指定",seed:"シード値を設定",steps:"ステップ数を設定",scale:"CFG スケール値を設定",strength:"ノイズ除去強度を設定",noise:"ノイズ強度を設定",hiresFix:"高解像度修正を有効",undesired:"反対呪文 (ネガティブプロンプト) を設定",noTranslator:"自動翻訳を無効",iterations:"画像生成数を設定"},messages:{"exceed-max-iteration":"画像生成数が最大に超えました。","expect-prompt":"生成呪文を入力してください。","expect-image":"画像を入力してください。","latin-only":"英数字だけが入力可能です。","too-many-words":"入力した単語が多すぎる。","forbidden-word":"一部の入力した単語が禁止されている。","concurrent-jobs":`<random>
  <>後でね～今、猫の手も借りたいなの！</>
  <>描けるの、た、タブレットが起動できませんだから。</>
  <>じゃ、まず絵を教えて。</>
</random>`,waiting:`<random>
  <>私はプロ絵師だから、どんな絵でも描けるの。</>
  <>仕事している…</>
</random>`,pending:"仕事している前に {0} つの絵が完遂するべきです。","invalid-size":"向上モードは AI 生成画像のみに用いられる。img2img (指定画像から生成) を使いたければ、「--enhance」を追加せずにコマンドを再実行してください。","invalid-resolution":"無効な解像度。幅と高さが 64 の倍数である必要があります。","custom-resolution-unsupported":"カスタム画像解像度は使用できません。","file-too-large":"ファイルのサイズが大きすぎる。","unsupported-file-type":"ファイルのタイプがサポートされていません。","download-error":"画像のダウンロードに失敗しました。","unknown-error":"不明なエラーが発生しました。","response-error":"不明なエラーが発生しました ({0})。","empty-response":"サーバーが無効な画像を返されました、後で試してください。","request-failed":"リクエストが失敗しました ({0})，後で試してください。","request-timeout":"リクエストがタイムアウトしました。","invalid-password":"メールアドレスやパスワードが間違っています。","invalid-token":"期間切れたまたは無効なトークンです。管理者に連絡してください。",unauthorized:"アカウント契約が期間切れるか、トークンが認可されていません。管理者に連絡してください。"}},"novelai.upscale":{description:"AI で画像拡大",options:{scale:"拡大倍率を設定",resolution:"拡大目標解像度を設定",crop:"拡大する前に画像をクロップする",upscaler:"拡大モデルを設定",upscaler2:"拡大モデル２を設定",upscaler2visibility:"拡大モデル２の可視度を設定",upscaleFirst:"拡大する前にフェイス修正を行う"},messages:{"expect-image":"画像を入力してください。","download-error":"画像のダウンロードに失敗しました。","unknown-error":"不明なエラーが発生しました。"}}}}});var mt=x(k=>{_();var ct=k&&k.__createBinding||(Object.create?function(r,e,n,s){s===void 0&&(s=n);var l=Object.getOwnPropertyDescriptor(e,n);(!l||("get"in l?!e.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(r,s,l)}:function(r,e,n,s){s===void 0&&(s=n),r[s]=e[n]}),ut=k&&k.__exportStar||function(r,e){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&ct(e,r,n)};Object.defineProperty(k,"__esModule",{value:!0});k.apply=k.name=k.reactive=void 0;var u=(H(),te(F)),v=ae(),S=ke();ut(ae(),k);k.reactive=!0;k.name="novelai";var B=new u.Logger("novelai");function dt(r,e){if(u.Quester.isAxiosError(e)){if(e.response?.status===402)return r.text(".unauthorized");if(e.response?.status)return r.text(".response-error",[e.response.status]);if(e.code==="ETIMEDOUT")return r.text(".request-timeout");if(e.code)return r.text(".request-failed",[e.code])}return B.error(e),r.text(".unknown-error")}function pt(r,e){r.i18n.define("zh",De()),r.i18n.define("zh-TW",xe()),r.i18n.define("en",Me()),r.i18n.define("fr",Ae()),r.i18n.define("ja",Pe());let n=Object.create(null),s=new Set,l=null,h=()=>l||(l=(0,S.login)(r));r.accept(["token","type","email","password"],()=>l=null);let w=a=>i=>i.resolve(a)??!0,A=(...a)=>()=>a.includes(e.type),L=()=>!["login","token"].includes(e.type),D=a=>!L()&&w(e.features.anlas)(a),f=a=>!w(e.features.image)(a),I=(...a)=>i=>a.some(d=>d(i)),R=(a,i)=>{let d=+a;if(d*0===0&&Math.floor(d)===d&&d>0&&d<=i.resolve(e.maxSteps||1/0))return d;throw new Error},j=(a,i)=>{if(a in v.orientMap)return v.orientMap[a];let d=a.match(/^(\d+)[x×](\d+)$/);if(!d)throw new Error;let z=(0,S.closestMultiple)(+d[1]),N=(0,S.closestMultiple)(+d[2]);if(Math.max(z,N)>i.resolve(e.maxResolution||1/0))throw new u.SessionError("commands.novelai.messages.invalid-resolution");return{width:z,height:N,custom:!0}},Y=r.command("novelai <prompts:text>").alias("nai","imagine").userFields(["authority"]).shortcut("imagine",{i18n:!0,fuzzy:!0}).shortcut("enhance",{i18n:!0,fuzzy:!0,options:{enhance:!0}}).option("enhance","-e",{hidden:I(D,L,f)}).option("model","-m <model>",{type:v.models,hidden:L}).option("resolution","-r <resolution>",{type:j}).option("output","-o",{type:["minimal","default","verbose"]}).option("override","-O",{hidden:D}).option("sampler","-s <sampler>").option("seed","-x <seed:number>").option("steps","-t <step>",{type:R,hidden:D}).option("scale","-c <scale:number>").option("noise","-n <noise:number>",{hidden:I(D,L)}).option("strength","-N <strength:number>",{hidden:D}).option("hiresFix","-H",{hidden:()=>e.type!=="sd-webui"}).option("undesired","-u <undesired>").option("noTranslator","-T",{hidden:()=>!r.translator||!e.translator}).option("iterations","-i <iterations:posint>",{fallback:1,hidden:()=>e.maxIterations<=1}).action(async({session:a,options:i},d)=>{var z;if(!d?.trim())return a.execute("help novelai");if(i.resolution?.custom&&D(a))return a.text(".custom-resolution-unsupported");if(i.iterations&&i.iterations>e.maxIterations)return a.text(".exceed-max-iteration",[e.maxIterations]);let N=w(e.features.text)(a),Z=w(e.features.image)(a),g,E;if(D(a))d=(0,u.h)("",u.h.transform(u.h.parse(d),{image(o){throw new u.SessionError("commands.novelai.messages.invalid-content")}})).toString(!0),delete i.enhance,delete i.steps,delete i.noise,delete i.strength,delete i.override;else{if(d=(0,u.h)("",u.h.transform(u.h.parse(d),{image(o){if(!Z)throw new u.SessionError("commands.novelai.messages.invalid-content");if(g)throw new u.SessionError("commands.novelai.messages.too-many-images");return g=o.url,""}})).toString(!0),i.enhance&&!g)return a.text(".expect-image");if(!d.trim()&&!e.basePrompt)return a.text(".expect-prompt")}if(!N&&!g)return a.text(".expect-image");if(e.translator&&r.translator&&!i.noTranslator)try{d=await r.translator.translate({input:d,target:"en"})}catch(o){B.warn(o)}let[se,Q,oe]=(0,v.parseInput)(a,d,e,i.override);if(se)return a.text(se);let X;try{X=await h()}catch(o){return o instanceof S.NetworkError?a.text(o.message,o.params):(B.error(o),a.text(".unknown-error"))}let le=v.modelMap[i.model],p={seed:i.seed||Math.floor(Math.random()*Math.pow(2,32)),prompt:Q,n_samples:1,uc:oe,ucPreset:2,qualityToggle:!1,scale:i.scale??a.resolve(e.scale),steps:i.steps??a.resolve(g?e.imageSteps:e.textSteps)};if(g){try{E=await(0,S.download)(r,g)}catch(o){return o instanceof S.NetworkError?a.text(o.message,o.params):(B.error(o),a.text(".download-error"))}if(i.enhance){let o=(0,S.getImageSize)(E.buffer);if(o.width+o.height!==1280)return a.text(".invalid-size");Object.assign(p,{height:o.height*1.5,width:o.width*1.5,noise:i.noise??0,strength:i.strength??.2})}else i.resolution||(i.resolution=(0,S.resizeInput)((0,S.getImageSize)(E.buffer))),Object.assign(p,{height:i.resolution.height,width:i.resolution.width,noise:i.noise??.2,strength:i.strength??.7})}else{if(!i.resolution){let o=a.resolve(e.resolution);i.resolution=typeof o=="string"?v.orientMap[o]:o}Object.assign(p,{height:i.resolution.height,width:i.resolution.width})}(i.hiresFix||e.hiresFix)&&(p.strength??(p.strength=.75));let je=()=>Math.random().toString(36).slice(2),V=Array(i.iterations).fill(0).map(je);if(e.maxConcurrency){let o=n[z=a.cid]||(n[z]=new Set);if(o.size>=e.maxConcurrency)return a.text(".concurrent-jobs");V.forEach(O=>o.add(O))}a.send(s.size?a.text(".pending",[s.size]):a.text(".waiting")),V.forEach(o=>s.add(o));let ce=o=>{n[a.cid]?.delete(o),s.delete(o)},ze=(()=>{switch(e.type){case"sd-webui":return E?"/sdapi/v1/img2img":"/sdapi/v1/txt2img";case"stable-horde":return"/api/v2/generate/async";case"naifu":return"/generate-stream";default:return"/ai/generate-image"}})(),Ee=()=>{switch(e.type){case"login":case"token":case"naifu":return p.sampler=v.sampler.sd2nai(i.sampler),p.image=E?.base64,e.type==="naifu"?p:{model:le,input:Q,parameters:(0,u.omit)(p,["prompt"])};case"sd-webui":return{sampler_index:v.sampler.sd[i.sampler],init_images:E&&[E.dataUrl],restore_faces:e.restoreFaces??!1,enable_hr:i.hiresFix??e.hiresFix??!1,...(0,S.project)(p,{prompt:"prompt",batch_size:"n_samples",seed:"seed",negative_prompt:"uc",cfg_scale:"scale",steps:"steps",width:"width",height:"height",denoising_strength:"strength"})};case"stable-horde":{let o=a.resolve(e.nsfw);return{prompt:p.prompt,params:{sampler_name:i.sampler.replace("_ka",""),cfg_scale:p.scale,denoising_strength:p.strength,seed:p.seed.toString(),height:p.height,width:p.width,post_processing:[],karras:i.sampler.includes("_ka"),steps:p.steps,n:1},nsfw:o!=="disallow",trusted_workers:e.trustedWorkers,censor_nsfw:o==="censor",models:[i.model],source_image:E?.base64,source_processing:E?"img2img":void 0,r2:!0}}}},Te=()=>{switch(e.type){case"login":case"token":case"naifu":return{Authorization:`Bearer ${X}`};case"stable-horde":return{apikey:X}}},qe=async()=>{let o=async()=>{let y=await r.http.axios((0,u.trimSlash)(e.endpoint)+ze,{method:"POST",timeout:e.requestTimeout,headers:{...e.headers,...Te()},data:Ee()});if(e.type==="sd-webui")return(0,S.forceDataPrefix)(y.data.images[0]);if(e.type==="stable-horde"){let C=y.data.id,U=()=>r.http.get((0,u.trimSlash)(e.endpoint)+"/api/v2/generate/check/"+C).then(J=>J.done),K=J=>new Promise(Ne=>setTimeout(Ne,J));for(;await U()===!1;)await K(e.pollInterval);let de=await r.http.get((0,u.trimSlash)(e.endpoint)+"/api/v2/generate/status/"+C),pe=de.generations[0].img;if(!pe.startsWith("http"))return(0,S.forceDataPrefix)(de.generations[0].img,"image/webp");let me=await r.http.axios(pe,{responseType:"arraybuffer"}),Re=M.from(me.data).toString("base64");return(0,S.forceDataPrefix)(Re,me.headers["content-type"])}return(0,S.forceDataPrefix)(y.data?.slice(27))},O,Fe=0;for(;;)try{O=await o();break}catch(y){if(u.Quester.isAxiosError(y)&&y.code&&y.code!=="ETIMEDOUT"&&++Fe<e.maxRetryCount)continue;return await a.send(dt(a,y))}if(!O.trim())return await a.send(a.text(".empty-response"));function Le(){let y=a.resolve(i.output??e.output);if(y==="minimal")return u.h.image(O);let C={userId:a.userId,nickname:a.author?.nickname||a.username},U=(0,u.h)("figure"),K=[`seed = ${p.seed}`];return y==="verbose"&&(L()||K.push(`model = ${le}`),K.push(`sampler = ${i.sampler}`,`steps = ${p.steps}`,`scale = ${p.scale}`),p.image&&K.push(`strength = ${p.strength}`,`noise = ${p.noise}`)),U.children.push((0,u.h)("message",C,K.join(`
`))),U.children.push((0,u.h)("message",C,`prompt = ${Q}`)),y==="verbose"&&U.children.push((0,u.h)("message",C,`undesired = ${oe}`)),U.children.push((0,u.h)("message",C,u.h.image(O))),U}let ue=await a.send(Le());ue.length&&e.recallTimeout&&r.setTimeout(()=>{for(let y of ue)a.bot.deleteMessage(a.channelId,y)},e.recallTimeout)};for(;V.length;)try{await qe(),ce(V.pop()),p.seed++}catch(o){throw V.forEach(ce),o}});r.accept(["model","sampler"],a=>{let i=()=>{switch(a.type){case"sd-webui":return v.sampler.sd;case"stable-horde":return v.sampler.horde;default:return v.sampler.nai}};Y._options.model.fallback=a.model,Y._options.sampler.fallback=a.sampler,Y._options.sampler.type=Object.keys(i())},{immediate:!0});let Ie=r.intersect(A("sd-webui")).intersect(w(e.features.upscale)).command("novelai.upscale").shortcut("upscale",{i18n:!0,fuzzy:!0}).option("scale","-s <scale:number>",{fallback:2}).option("resolution","-r <resolution>",{type:j}).option("crop","-C, --no-crop",{value:!1,fallback:!0}).option("upscaler","-1 <upscaler>",{type:v.upscalers}).option("upscaler2","-2 <upscaler2>",{type:v.upscalers}).option("visibility","-v <visibility:number>").option("upscaleFirst","-f",{fallback:!1}).action(async({session:a,options:i},d)=>{let z;if(u.h.transform(d,{image(g){return z=g.url,""}}),!z)return a.text(".expect-image");let N;try{N=await(0,S.download)(r,z)}catch(g){return g instanceof S.NetworkError?a.text(g.message,g.params):(B.error(g),a.text(".download-error"))}let Z={image:N.dataUrl,resize_mode:i.resolution?1:0,show_extras_results:!0,upscaling_resize:i.scale,upscaling_resize_h:i.resolution?.height,upscaling_resize_w:i.resolution?.width,upscaling_crop:i.crop,upscaler_1:i.upscaler,upscaler_2:i.upscaler2??"None",extras_upscaler_2_visibility:i.visibility??1,upscale_first:i.upscaleFirst};try{let{data:g}=await r.http.axios((0,u.trimSlash)(e.endpoint)+"/sdapi/v1/extra-single-image",{method:"POST",timeout:e.requestTimeout,headers:{...e.headers},data:Z});return u.h.image((0,S.forceDataPrefix)(g.image))}catch(g){return B.warn(g),a.text(".unknown-error")}});r.accept(["upscaler"],a=>{Ie._options.upscaler.fallback=a.upscaler},{immediate:!0})}k.apply=pt});export default mt();
