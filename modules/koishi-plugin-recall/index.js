var y=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var I=(e,t)=>()=>(e&&(t=e(e=0)),t);var b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var h=(e,t,i,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of C(t))!S.call(e,n)&&n!==i&&y(e,n,{get:()=>t[n],enumerable:!(l=j(t,n))||l.enumerable});return e},p=(e,t,i)=>(h(e,t,"default"),i&&h(i,t,"default"));var T=e=>h(y({},"__esModule",{value:!0}),e);import{Buffer as q}from"https://registry.koishi.chat/modules/buffer/index.js";import v from"https://registry.koishi.chat/modules/process/index.js";var u=I(()=>{});var m={};import*as F from"https://registry.koishi.chat/modules/koishi/index.js";var w=I(()=>{u();p(m,F)});var _=b((G,k)=>{k.exports={commands:{recall:{description:"撤回机器人发送的消息",messages:{"no-recent":"近期没有发送消息。"}}}}});var B=b(o=>{u();Object.defineProperty(o,"__esModule",{value:!0});o.apply=o.name=o.Config=void 0;var f=(w(),T(m));o.Config=f.Schema.object({timeout:f.Schema.natural().role("ms").default(f.Time.hour).description("消息保留的时间。")});o.name="recall";function z(e,{timeout:t}){let i=e.logger("recall");e.i18n.define("zh",_()),e=e.guild();let l={};e.on("send",a=>{var d;let r=l[d=a.channelId]||(l[d]=[]);r.unshift(a.messageId),e.setTimeout(()=>(0,f.remove)(r,a.messageId),t)}),e.command("recall [count:number]",{authority:2}).action(async({session:a},d=1)=>{let r=l[a.channelId];if(a.quote){let c=r?.findIndex(M=>M===a.quote.messageId);c&&r.splice(c,1),await n(a.bot,a.channelId,a.quote.messageId);return}if(!r)return a.text(".no-recent");let g=r.splice(0,d),s=e.root.config.delay.broadcast;r.length||delete l[a.channelId];for(let c=0;c<g.length;c++)c&&s&&await(0,f.sleep)(s),await n(a.bot,a.channelId,g[c])});async function n(a,d,r){try{await a.deleteMessage(d,r)}catch(g){i.warn(g)}}}o.apply=z});export default B();
